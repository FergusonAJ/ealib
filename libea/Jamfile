import testing ;
import os ;
local PREFIX = [ os.environ PREFIX ] ;

if $(PREFIX) = "" {
    PREFIX = "/usr/local" ;
}

alias libea : : : : <include>./include ;

alias libea_libs :
    /boost//serialization
    /boost//iostreams
    /boost//regex
    /boost//system
    /boost//filesystem
    /boost//program_options
    /site-config//z
    ;

lib libea_runner :
    src/main.cpp
    src/cmdline_interface.cpp
    libea
    libea_libs
    ;

unit-test serialization : 
    test/test_serialization.cpp
    test/test_metadata.cpp
    test/test_rng.cpp
    test/test_information.cpp
    test/test_analysis.cpp
    test/test.cpp
    libea
    libea_libs
    /boost//unit_test_framework
    ;

unit-test torus : 
    test/test_torus.cpp
    libea
    libea_libs
    /boost//unit_test_framework
    ;

unit-test lsystem : 
    test/test_lsystem.cpp
    libea
    libea_libs
    /boost//unit_test_framework
    ;

unit-test lod : 
    test/test_lod.cpp
    test/test.cpp
    libea
    libea_libs
    /boost//unit_test_framework
    ;

unit-test metapopulation : 
    test/test_metapopulation.cpp
    test/test_qhfc.cpp
    test/test.cpp
    libea
    libea_libs
    /boost//unit_test_framework
    ;

unit-test digevo : 
    test/test_digital_evolution.cpp
    test/test_digital_evolution_types.cpp
    test/test.cpp
    libea
    libea_libs
    /boost//unit_test_framework
    ;

alias install : install-lib install-headers ;

install install-lib :
    libea_runner
    : <location>$(PREFIX)/lib <install-type>LIB <install-dependencies>on
    ;

install install-headers :
    [ glob-tree *.h : test ]
    : <location>$(PREFIX)/include <install-source-root>include
    ;

explicit install install-lib install-headers ;
